import { Callout, Tabs, Tab } from 'nextra-theme-docs'
import { BadgeFD, BadgeZustand, BadgeRQ, BadgeSWR, StoreEvent } from '../_components/Comparison'

# Comparison

## Feature Comparison

<Callout type="info">
  <div>Legend</div>
  <div>âœ… : Supported</div>
  <div>ðŸ”¶ : Not built-in, but we can make our own</div>
  <div>ðŸ”´ : Not officially supported or documented</div>
  <div>ðŸš§ : Work in progress</div>
</Callout>

<section className="pt-6 [&_tr:nth-child(2n)]:bg-transparent dark:[&_tr:nth-child(2n)]:!bg-transparent text-sm [&_tr:hover]:!bg-gray-400/10 dark:[&_tr:hover]:!bg-white/10 dark:[&_tr:nth-child(2n):hover]:!bg-white/10">

|                                                            |         Floppy Disk @2.7.0          |  Zustand @4.4.1  | TanStack<br/>Query<br/>@4.33.0 |  SWR @2.2.2  |
| ---------------------------------------------------------- | :---------------------------------: | :--------------: | :----------------------------: | :----------: |
| Bundle size (https://pkg-size.dev)                         |             <BadgeFD />             | <BadgeZustand /> |          <BadgeRQ />           | <BadgeSWR /> |
| Dependencies                                               |                  0                  |        1         |               2                |      2       |
| TypeScript                                                 |                 âœ…                  |        âœ…        |               âœ…               |      âœ…      |
| Create store                                               |                 âœ…                  |        âœ…        |                                |              |
| - Selecting state slices                                   |                 âœ…                  |        âœ…        |                                |              |
| - Async actions                                            |                 âœ…                  |        âœ…        |                                |              |
| - Read/write state outside component                       |                 âœ…                  |        âœ…        |                                |              |
| - Subscribe changes outside component                      |                 âœ…                  |        âœ…        |                                |              |
| - Subscribe with selector                                  |                 âœ…                  |        âœ…        |                                |              |
| - Without React                                            |                 âœ…                  |        âœ…        |                                |              |
| - Transient updates                                        |                 âœ…                  |        âœ…        |                                |              |
| - Using Immer                                              |                 âœ…                  |        âœ…        |                                |              |
| - Middleware                                               |                 âœ…                  |        âœ…        |                                |              |
| - Persist middleware                                       |              ðŸš§ ðŸ”¶ ðŸš§               |        âœ…        |                                |              |
| - Immer middleware                                         |              ðŸš§ ðŸ”¶ ðŸš§               |        âœ…        |                                |              |
| - Omit state key                                           | ðŸ”´ <sup className="-mr-4">[1]</sup> |        âœ…        |                                |              |
| - Redux devtool                                            |                 ðŸ”´                  |        âœ…        |                                |              |
| - Intercept set state                                      |                 âœ…                  |        ðŸ”¶        |                                |              |
| - Silently update state                                    |                 âœ…                  |        ðŸ”´        |                                |              |
| - <StoreEvent />                                           |                 âœ…                  |        ðŸ”´        |                                |              |
| Create stores                                              |                 âœ…                  |        ðŸ”´        |                                |              |
| Queries & Mutations                                        |                 âœ…                  |                  |               âœ…               |      âœ…      |
| - SSR/SSG support                                          |                 âœ…                  |                  |               âœ…               |      âœ…      |
| - React Suspense                                           |                 âœ…                  |                  |               âœ…               |      âœ…      |
| - Cache persistence                                        |                 âœ…                  |                  |               âœ…               |      âœ…      |
| - Parallel queries                                         |                 âœ…                  |                  |               âœ…               |      âœ…      |
| - Dependent queries                                        |                 âœ…                  |                  |               âœ…               |      âœ…      |
| - Lazy queries                                             |                 âœ…                  |                  |               âœ…               |      âœ…      |
| - Lagged queries                                           |                 âœ…                  |                  |               âœ…               |      âœ…      |
| - Paginated queries                                        |                 âœ…                  |                  |               âœ…               |      âœ…      |
| - Infinite queries                                         |                 âœ…                  |                  |               âœ…               |      âœ…      |
| - Bi-directional infinite queries                          |                 âœ…                  |                  |               âœ…               |      ðŸ”¶      |
| - Infinite queries refetching                              |                 âœ…                  |                  |               âœ…               |      âœ…      |
| - Prefetching                                              |                 âœ…                  |                  |               âœ…               |      âœ…      |
| - Retrying                                                 |                 âœ…                  |                  |               âœ…               |      âœ…      |
| - Stale while revalidate                                   |                 âœ…                  |                  |               âœ…               |      âœ…      |
| - Initial data                                             |                 âœ…                  |                  |               âœ…               |      âœ…      |
| - Scroll recovery                                          |                 âœ…                  |                  |               âœ…               |      âœ…      |
| - Render optimization                                      |                 âœ…                  |                  |               âœ…               |      âœ…      |
| - Cache manipulation                                       |                 âœ…                  |                  |               âœ…               |      âœ…      |
| - Optimistic updates                                       |                 âœ…                  |                  |               âœ…               |      âœ…      |
| - Selectors                                                |                 âœ…                  |                  |               âœ…               |      ðŸ”´      |
| - Partial query matching                                   |                 âœ…                  |                  |               âœ…               |      ðŸ”¶      |
| - Window focus refetching                                  |                 âœ…                  |                  |               âœ…               |      âœ…      |
| - Network status refetching                                |                 âœ…                  |                  |               âœ…               |      âœ…      |
| - Polling/intervals                                        |                 âœ…                  |                  |               âœ…               |      âœ…      |
| - Query cancellation                                       |              ðŸš§ ðŸ”¶ ðŸš§               |                  |               âœ…               |      ðŸ”´      |
| - Offline mutation support                                 |              ðŸš§ ðŸ”¶ ðŸš§               |                  |               âœ…               |      ðŸ”´      |
| - Auto garbage collection                                  |                 âœ…                  |                  |               âœ…               |      ðŸ”´      |
| - Does not need provider wrapper                           |                 âœ…                  |                  |               ðŸ”´               |      âœ…      |
| - Read/write query/mutation state outside component        |                 âœ…                  |                  |               âœ…               |      ðŸ”´      |
| - Subscribe query/mutation state changes outside component |                 âœ…                  |                  |               âœ…               |      ðŸ”´      |
| - Devtool                                                  |                 ðŸ”´                  |                  |               âœ…               |      âœ…      |

**Notes:**<br /><sup>[1]</sup> Do we really need that feature? We can just set a state slice to `undefined`.

</section>

## DX Comparison

<Tabs items={['Floppy Disk', 'Zustand']}>
  <Tab>
    ```tsx {4,24,25,29,36,37} showLineNumbers
    import { createStore } from 'floppy-disk';

    export const useMyStore = createStore(
      ({ set, get }) => ({
        count: 3,
        shape: 'square',
        increment: () => set((prev) => ({ count: prev.count + 1 })),
        changeShape: () => {
          const { shape } = get();
          let nextShape;
          if (shape === 'square') nextShape = 'circle';
          else if (shape === 'circle') nextShape = 'triangle';
          else nextShape = 'square';
          set({ shape: nextShape });
        },
      })
    );

    function MyComponent() {
      // Subscribe all changes
      const { count, shape } = useMyStore();

      // Subscribe to single slice
      const { count } = useMyStore((state) => [state.count]);
      const { shape } = useMyStore((state) => [state.shape]);

      // Subscribe to multiple slices
      const { count, shape } = useMyStore(
        (state) => [state.count, state.shape]
      );

      ...
    }

    // Get/set state outside component
    const getShape = () => useMyStore.get().shape;
    const increment = () => useMyStore.set((state) => ({ count: state.count + 1 }));
    ```

  </Tab>
  <Tab>
    ```tsx {4,24,25,29,30,37,38} showLineNumbers
    import { create } from 'zustand';

    export const useMyStore = create(
      (set, get) => ({
        count: 3,
        shape: 'square',
        increment: () => set((prev) => ({ count: prev.count + 1 })),
        changeShape: () => {
          const { shape } = get();
          let nextShape;
          if (shape === 'square') nextShape = 'circle';
          else if (shape === 'circle') nextShape = 'triangle';
          else nextShape = 'square';
          set({ shape: nextShape });
        },
      })
    );

    function MyComponent() {
      // Subscribe all changes
      const { count, shape } = useMyStore();

      // Subscribe to single slice
      const count = useMyStore((state) => state.count);
      const shape = useMyStore((state) => state.shape);

      // Subscribe to multiple slices
      const { count, shape } = useMyStore(
        (state) => ({ count: state.count, shape: state.shape }),
        shallow // import shallow from 'zustand/shallow'
      );

      ...
    }

    // Get/set state outside component
    const getShape = () => useMyStore.getState().shape;
    const increment = () => useMyStore.setState((state) => ({ count: state.count + 1 }));
    ```

  </Tab>
</Tabs>

<Tabs items={['Floppy Disk', 'TanStack Query']}>
  <Tab>
    ```tsx {1,26} showLineNumbers
    const usePokemonDetailQuery = createQuery(fetchPokemonById);

    function PokemonDetailPage({ id }) {
      const { isLoading, data, error } = usePokemonDetailQuery({ id });
      if (error) return <div>Something went wrong</div>;
      if (isLoading) return <div>Loading...</div>;
      return (
        <main>
          <h1>{data.name}</h1>
          <PokemonAttribute id={id} />
        </main>
      );
    }

    function PokemonAttribute({ id }) {
      const { data } = usePokemonDetailQuery({ id });
      return (
        <section>
          <div>Weight: {data.weight}</div>
          <div>Height: {data.height}</div>
        </section>
      );
    }

    // Outside component
    const prefetchPokemonById = ({ id }) => usePokemonDetailQuery.get({ id }).fetch();
    ```

  </Tab>
  <Tab>
    ```tsx {1,5,7,11-16,41-47} showLineNumbers
    const queryClient = new QueryClient();

    function App() {
      return (
        <QueryClientProvider client={queryClient}>
          <Page />
        </QueryClientProvider>
      );
    }

    const usePokemonDetailQuery = ({ id }) => {
      return useQuery(
        ['pokemon', id],
        () => fetchPokemonById({ id })
      );
    };

    function PokemonDetailPage({ id }) {
      const { isLoading, data, error } = usePokemonDetailQuery({ id });
      if (error) return <div>Something went wrong</div>;
      if (isLoading) return <div>Loading...</div>;
      return (
        <main>
          <h1>{data.name}</h1>
          <PokemonAttribute id={id} />
        </main>
      );
    }

    function PokemonAttribute({ id }) {
      const { data } = usePokemonDetailQuery({ id });
      return (
        <section>
          <div>Weight: {data.weight}</div>
          <div>Height: {data.height}</div>
        </section>
      );
    }

    function SomeComponent() {
      const queryClient = useQueryClient({ context });
      const prefetchPokemonById = ({ id }) => {
        queryClient.prefetchQuery({
          queryKey: ['pokemon', id],
          queryFn: () => fetchPokemonById({ id }),
        });
      };

      //...
    }
    ```

  </Tab>
</Tabs>
